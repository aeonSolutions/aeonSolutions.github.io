<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Extracting location history</title>
  <meta name="description" content="<strong>If you have an android phone then google logs your location.
Fortunately, it makes all of that data available to you via the “timeline” dashboard.
Unfortunately, there is no easy way to get it off there and into an IDE.
So we’ll have to do this the hard way!</strong>

">
  <meta name="author" content="Laurens Geffert">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Extracting location history">
  <meta name="twitter:description" content="<strong>If you have an android phone then google logs your location.
Fortunately, it makes all of that data available to you via the “timeline” dashboard.
Unfortunately, there is no easy way to get it off there and into an IDE.
So we’ll have to do this the hard way!</strong>

">
  
  <meta name="twitter:creator" content="JanLauGe">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Extracting location history">
  <meta property="og:description" content="<strong>If you have an android phone then google logs your location.
Fortunately, it makes all of that data available to you via the “timeline” dashboard.
Unfortunately, there is no easy way to get it off there and into an IDE.
So we’ll have to do this the hard way!</strong>

">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="images/favicons/manifest.json">
  <link rel="shortcut icon" href="images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="css/main.css?1539431935741611000">
  <link rel="canonical" href="http://localhost:4000/2017/extracting-location-history/">
  <link rel="alternate" type="application/rss+xml" title="Laurens Geffert" href="feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="" title="link to home of Laurens Geffert">
          <img src="images/profile.png" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Laurens Geffert</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">Data Science Portfolio</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">

      		  <!-- Blog Button -->
      		  <ul class="navigation">
      			  <li class="navigation__item"><a href="/index" title="Blog posts" class="blog-button">Blog</a></li>
      		  </ul>

      		  <!-- About Button -->
      		  <ul class="navigation">
      			  <li class="navigation__item"><a href="/about" title="About the author" class="blog-button">About</a></li>
      		  </ul>

      		  <!-- Blog Roll -->
      		  <ul class="navigation">
      			  <li class="navigation__item"><a href="/links" title="Links to other sites" class="blog-button">Links</a></li>
      		  </ul>

          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

              
                <!-- GitHub -->
                <li class="navigation__item">
                  <a href="https://www.github.com/JanLauGe" title="JanLauGe on GitHub" target="_blank">
                    <i class="icon icon-social-github"></i>
                    <span class="label">GitHub</span>
                  </a>
                </li>
              

  			      
                <!-- Twitter -->
                <li class="navigation__item">
                  <a href="http://twitter.com/JanLauGe" title="@JanLauGe on Twitter" target="_blank">
                    <i class="icon icon-social-twitter"></i>
                    <span class="label">Twitter</span>
                  </a>
                </li>
              

              
                <!-- LinkedIn -->
                <li class="navigation__item">
                  <a href="https://www.linkedin.com/in/laurensgeffert" title="laurensgeffert on LinkedIn" target="_blank">
                    <i class="icon icon-social-linkedin"></i>
                    <span class="label">LinkedIn</span>
                  </a>
                </li>
              

        			
        			  <!-- Stackoverflow -->
        			  <li class="navigation__item">
        				  <a href="https://stackoverflow.com/users/5457259/janlauge" title="janlauge on StackOverflow" target="_blank">
        				    <i class="icon icon-social-stack-overflow"></i>
        				    <span class="label">Stackoverflow</span>
        				  </a>
        			  </li>
              

              
        			  <!-- Kaggle -->
        			  <li class="navigation__item">
        				  <a href="https://www.kaggle.com/janlauge" title="janlauge on Kaggle" target="_blank">
        				    <i class="icon icon-trophy"></i>
        				    <span class="label">Kaggle</span>
        				  </a>
        			  </li>
              

        			
        			  <!-- Googlescholar -->
        			  <li class="navigation__item">
                  <a href="https://scholar.google.co.uk/citations?user=_aqDDYYAAAAJ&hl=en" title="Laurens Geffert on Google Scholar" target="_blank">
                    <i class="icon icon-social-google-plus"></i>
                    <span class="label">Google Scholar</span>
                  </a>
                </li>
              

              

              
                <!-- Email -->
                <li class="navigation__item">
                  <a href="mailto:laurensgeffert@gmail.com" title="Email laurensgeffert@gmail.com" target="_blank">
                    <i class="icon icon-mail"></i>
                    <span class="label">Email</span>
                  </a>
                </li>
              

              <!-- RSS -->
              <li class="navigation__item">
                <a href="feed.xml" title="Subscribe" target="_blank">
                  <i class="icon icon-rss"></i>
                  <span class="label">RSS</span>
                </a>
              </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="21 Oct 2017" class="post-meta__date date">21 Oct 2017</time>
      
      &#8226; <span class="post-meta__tags">on <a href="tags/#DataScience">DataScience</a> <a href="tags/#Python">Python</a> <a href="tags/#WebScraping">WebScraping</a> <a href="tags/#Coding">Coding</a> <a href="tags/#Tools">Tools</a> </span>
      
    </div>
    <h1 class="post-title">Extracting location history</h1>
  </header>

  <section class="post">
    <p><strong>If you have an android phone then google logs your location.
Fortunately, it makes all of that data available to you via the “timeline” dashboard.
Unfortunately, there is no easy way to get it off there and into an IDE.
So we’ll have to do this the hard way!</strong>
<!--more--></p>

<h2 id="location-history">Location History</h2>
<p>What did you do yesterday? Last week? Or on August the 17th at 15:00?
The answer, at least to the last question, possibly used to be quite a stretch.
But as many things, this has changed with the advent of our everyday companion,
the smart phone.</p>

<p>If you have a smart phone and you carry it around with you, your whereabouts are
constantly logged and saved. For android phones with google maps, google infers
your position based on a mix of GPS, cell phone towers, WiFi name lookup,
and other factors, and saves it in a “location history”. This data is available
to you via the (relatively new) “timeline” feature in google maps.</p>

<p><img src="http://localhost:4000/assets/extract-location-history_timeline.png" alt="Game example" /></p>

<h2 id="the-problem">The Problem</h2>
<p>As always, Google’s dashboard is very intuitive to navigate and offers great
functionality. There is just one problem: I cannot summarise, report on, or
programmatically analyse my data. It’s locked into google’s systems.</p>

<p>Because our location data is undoubtedly our personal property, google offers
us the option to download it in <code class="highlighter-rouge">.kml</code> format. However, this is only available
via the web interface. If I wanted to build personalised reports on top of the
data, I would need programmatic access via an API that I can pass parameters
such as date and time to retrieve data dynamically. That is currently not
supported by google. But with a little bit of manual work, we will get there
nonetheless!</p>

<h2 id="the-solution">The Solution</h2>
<p>After a little bit of digging around I found <a href="https://medium.com/alex-attia-blog/how-to-take-back-control-and-use-your-google-maps-data-683fb5d4043e">this Medium post</a>
and <a href="https://github.com/alexattia/Maps-Location-History">this associated GitHub repository</a>
that got me 90% of the way very quickly. Alex, if you’re reading this, thanks
a ton for putting all of that together! The code on GitHub was still missing
yearly and daily sub-setting functionality, so I added that in
<a href="https://github.com/JanLauGe/c_google_timeline">my repository</a>
(pull request submitted!).</p>

<p>So how to use this? Here are the step-by-step instructions.</p>

<p>In bash:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Clone the code repository</span>
git clone https://github.com/JanLauGe/c_google_timeline
</code></pre></div></div>

<p>Next, we’ll have to do some manual work. This is because we will need information
from our google account sign in, saved in our cookies, in order to authenticate
our <code class="highlighter-rouge">GET</code> requests for <code class="highlighter-rouge">KML</code> file downloads.</p>
<ol>
  <li>Open https://www.google.com/maps/timeline in Mozilla Firefox (I tried Chrome first, it did not work for me)</li>
  <li>Inspect the page (<code class="highlighter-rouge">Ctrl + Shift + I</code>) and go to the Network tab</li>
  <li>Enter the link below in the address line of your browser: https://www.google.com/maps/timeline/kml</li>
  <li>A new event will appear in the inspect-network tab as a result of the request. Copy its content as a cURL</li>
  <li>Paste the cURL string to a text editor and save it as a key file (I used ‘~/.env/.google_maps_cookie’)</li>
</ol>

<p>Now that we have the cookie information, we can go back to the fun part in Python:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="n">DT</span>
<span class="kn">import</span> <span class="nn">process_location</span>

<span class="c"># Get inputs --------------------------</span>
<span class="c"># Date info</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">DT</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">end_day</span> <span class="o">=</span> <span class="n">today</span><span class="o">.</span><span class="n">day</span>
<span class="n">end_month</span> <span class="o">=</span> <span class="n">today</span><span class="o">.</span><span class="n">month</span>
<span class="n">end_year</span> <span class="o">=</span> <span class="n">today</span><span class="o">.</span><span class="n">year</span>

<span class="n">lastweek</span> <span class="o">=</span> <span class="n">today</span> <span class="o">-</span> <span class="n">DT</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">begin_day</span> <span class="o">=</span> <span class="n">lastweek</span><span class="o">.</span><span class="n">day</span>
<span class="n">begin_month</span> <span class="o">=</span> <span class="n">lastweek</span><span class="o">.</span><span class="n">month</span>
<span class="n">begin_year</span> <span class="o">=</span> <span class="n">lastweek</span><span class="o">.</span><span class="n">year</span>

<span class="c"># Cookie info</span>
<span class="n">cookie_content</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'~/.env/.google_maps_cookie'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c"># Remove line break at end of string</span>
<span class="n">cookie_content</span> <span class="o">=</span> <span class="n">cookie_content</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c"># Where to save the files</span>
<span class="n">folder</span> <span class="o">=</span> <span class="s">'~/google_timeline/data/'</span>

<span class="c"># Get files --------------------------</span>
<span class="n">process_location</span><span class="o">.</span><span class="n">create_kml_files</span><span class="p">(</span>
    <span class="n">begin_year</span><span class="o">=</span><span class="n">begin_year</span><span class="p">,</span>
    <span class="n">begin_month</span><span class="o">=</span><span class="n">begin_month</span><span class="p">,</span>
    <span class="n">begin_day</span><span class="o">=</span><span class="n">begin_day</span><span class="p">,</span>
    <span class="n">end_year</span><span class="o">=</span><span class="n">end_year</span><span class="p">,</span>
    <span class="n">end_month</span><span class="o">=</span><span class="n">end_month</span><span class="p">,</span>
    <span class="n">end_day</span><span class="o">=</span><span class="n">end_day</span><span class="p">,</span>
    <span class="n">cookie_content</span><span class="o">=</span><span class="n">cookie_content</span><span class="p">,</span>
    <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
</code></pre></div></div>

<p>This will download the <code class="highlighter-rouge">KML</code> files (one per day) for the last week.
I’ll leave it at that for now. If you would like to know how to read the files
into a pandas data frame, check out <a href="https://github.com/alexattia/Maps-Location-History">Alexandre Attia’s repo</a>,
or come back here later. I already have a specific application in mind for this,
but that is a story for another post.</p>

<p>As always, hope this is useful for you. Please leave a comment below.
I have enabled anonymous commenting to remove the entry hurdle of signing up to Disqus.</p>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = 'https://janlauge.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2018 Laurens Geffert. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="js/main.js?1539431935741611000"></script>


    </div>
  </body>
</html>